#!/usr/bin/lua

local socket = require("socket")

--local host, port = "192.168.10.1", 2009
local host, port = "localhost", 2009

local client = assert(socket.connect(host, port))
client:settimeout(nil) --blocking

local function send(s)
--	print("sending", s)
	client:send(s.."\n")
	local ret = client:receive()
--	print("ret:", ret)
	return ret
end

        --           pack [0xFF,0xFF, ID,  LEN, INS, P1..PN,  CHKS]
--        pack = string.char(0xFF,0xF1F,0xFE,0x04,0x03,0x03,0x06,0xF1) --changeid a 6
--        pack = string.char(0xFF,0xFF,0x08,0x02,0x01,0xF4) --ping a 8
--        pack = string.char(0xFF,0xFF,0x08,0x04,0x02,0x2B,0x01,0xC5) --temperature
--        pack = string.char(0xFF,0xFF,0x08,0x04,0x02,0x03,0x01,0xED) --read id
--        pack = string.char(0xFF,0xFF,0x01,0x02,0x06,0xF6)   --reset

local pack0 = string.char(0xFF,0xFF,0x08,0x04,0x02,0x24,0x04,0xC9)
local pack1 = string.char(0xFF,0xFF,0x08,0x04,0x02,0x24,0x02,0xCB)
local pack2 = string.char(0xFF,0xFF,0x08,0x04,0x02,0x26,0x02,0xC9)
local pack3 = string.char(0xFF,0xFF,0x08,0x04,0x02,0x24,0x03,0xCA)

--    print (send("CALL ax sendPacket "..pack1.." 1"))
--    print (send("CALL ax sendPacket "..pack2.." 1"))

while true do
    print (send("CALL ax sendPacket "..pack1.." 1"))
    socket.sleep(0.2)
end

